---
author: "Santiago Rodriguez (Optare Solutions)"
description: "Headless Test"
descriptor_schema: https://raw.githubusercontent.com/sonata-nfv/tng-schema/master/test-descriptor/testdescriptor-schema.yml
name: "comm-pilot-test"
vendor: "eu.5gtango"
version: '0.1'

service_platforms:
  - "OSM"
  - "SONATA"
test_category:
  - "basic-tests"

phases:
  - id: setup
    steps:
      - action: deploy
        description: "Deploying a NS"
        name: deployment
      - action: configure
        description: "Configuration"
        name: configuration
        probes:
          - id: headless-browser called
            description: "Headless browser called with Puppeteer"
            image: "danielvifal/docker-chromium-rec:latest"
            name: headless-browser called
            parameters:
	      - key: CALLED
                value: 'quobisqa1@quobis'
	      - key: PASSWORD
                value: 'PNrdj3G948WP'
	      - key: USER
                value: 'apps'
	  
	  - id: headless-browser caller
            description: "Headless browser caller with Puppeteer"
            image: "danielvifal/docker-chromium:latest"
            name: headless-browser caller
            parameters:
              - key: WEB
                value: 'https://rooms.quobis.com'
	      - key: CALLER
                value: 'quobisqa3@quobis'
	      - key: PASSWORD
                value: 'oWc0n2M84xt2'
	      - key: CALLED
                value: 'quobisqa1'
	      - key: DURATION
                value: '10000'
	      - key: USER
                value: 'apps'
  - id: exercise
    steps:
      - command: /bin/sh
        dependencies: []
        description: "Starting the initiator"
        entrypoint: /entrypoint.sh
        index: 1
        instances: 1
        name: headless-browser called
        output:
          - {results: results.log}
        run: headless-browser called
      - command: /bin/sh
        dependencies: []
        description: "Starting the initiator"
        entrypoint: /entrypoint.sh
        index: 1
        instances: 1
        name: headless-browser caller
        output:
          - {results: results.log}
        run: headless-browser caller

  - id: verification
    steps:
      - step: headless
        description: "Check obtained results"
        name: headless-browser caller
        conditions:
          - condition: present
            file: results.log
            find: PUPPETEER LOGS
            name: headless-ok
            verdict: pass
